<nav class="tabs" style="margin-bottom:1rem;">
  <a href="{{ url_for('account.profile') }}"    class="{{ 'active' if request.endpoint=='account.profile' else '' }}">Profile</a>
  <a href="{{ url_for('account.security') }}"   class="{{ 'active' if request.endpoint=='account.security' else '' }}">Security</a>
  <a href="{{ url_for('account.sessions') }}"   class="{{ 'active' if request.endpoint=='account.sessions' else '' }}">Sessions</a>
  <a href="{{ url_for('account.notifications') }}" class="{{ 'active' if request.endpoint=='account.notifications' else '' }}">Notifications</a>
  <a href="{{ url_for('account.privacy') }}"    class="{{ 'active' if request.endpoint=='account.privacy' else '' }}">Privacy</a>
</nav>
<style>
  .tabs a{padding:.5rem .75rem; border-radius:.5rem; text-decoration:none; border:1px solid #ddd; margin-right:.5rem; display:inline-block}
  .tabs a.active{background:#f2f2f2}
  form .row{margin-bottom:.75rem}
  form label{display:block; font-weight:600; margin-bottom:.25rem}
  form input, form select, form textarea{width:100%; padding:.5rem; border:1px solid #ddd; border-radius:.35rem}
  .btn{padding:.5rem .9rem; border:1px solid #ccc; border-radius:.5rem; background:#fff; cursor:pointer}
</style>
<script nonce="{{ g.csp_nonce }}">
(function(){
  function getCookie(name){
    return document.cookie.split('; ').reduce((a,v)=>{
      const [k,...r]=v.split('='); a[k]=r.join('='); return a;
    }, {})[name];
  }
  async function postWithJwt(form){
    const token = getCookie("csrf_access_token"); // set by JWT cookies
    const fd = new FormData(form);
    const resp = await fetch(form.action || location.href, {
      method: form.method || "POST",
      headers: token ? {"X-CSRF-TOKEN": token} : {},
      body: fd,
      credentials: "same-origin"
    });
    if (resp.redirected) { location.href = resp.url; return; }
    // best effort: reload so flashes render
    location.reload();
  }
  document.addEventListener("submit", function(e){
    const f = e.target;
    if (f.matches("form[data-jwt='1']")) {
      e.preventDefault();
      postWithJwt(f);
    }
  }, true);
})();
</script>
