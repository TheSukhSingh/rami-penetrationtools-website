{% extends "main.html" %}
{% block title %}Tools{% endblock %}

{% block content %}
<style>
  /* Minimal layout so the canvas + panels render correctly */
  .page-wrap { display: grid; grid-template-columns: 280px 1fr 380px; gap: 16px; height: calc(100vh - 120px); }
  #toolCategories { overflow: auto; border: 1px solid #ddd; border-radius: 8px; padding: 10px; }
  #canvas { position: relative; border: 1px solid #ddd; border-radius: 8px; background: #fafafa; overflow: hidden; }
  #connectionLayer { position:absolute; inset:0; width:100%; height:100%; pointer-events:none; }
  #canvasContent, #workflowBoxes { position:absolute; inset:0; }
  #toolbar { display:flex; align-items:center; gap:8px; margin-bottom:8px; flex-wrap: wrap; }
  #rightPanel { display:flex; flex-direction:column; min-height:0; }
  .panel { border:1px solid #ddd; border-radius:8px; padding:10px; background:#fff; }
  #terminalOutput { height:180px; overflow:auto; background:#0b1220; color:#d0e2ff; border-radius:6px; padding:10px; font: 12px/1.4 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
  #results { height:180px; overflow:auto; background:#f9fafb; border:1px dashed #ddd; border-radius:6px; padding:10px; }
  #runProgress { width:100%; height:8px; background:#eee; border-radius:999px; overflow:hidden; }
  #runProgressBar { width:0%; height:100%; background:#3b82f6; }
  #toast { position:fixed; z-index:9999; right:16px; bottom:16px; background:#111; color:#fff; padding:10px 14px; border-radius:8px; display:none; }
  .badge { padding:2px 8px; border-radius:999px; border:1px solid #ddd; background:#fff; font-size:12px; }
  .muted { opacity: .7; font-size: 12px; }
  .toolbar-spacer { flex:1; }
  /* Node state classes the JS toggles */
  .node-running { outline: 2px solid #3b82f6; }
  .node-complete { outline: 2px solid #22c55e; }
  .node-failed  { outline: 2px solid #ef4444; }
  #connectionLayer { pointer-events: none; }

</style>

<div id="toast" role="status" aria-live="polite"></div>

<div class="page-wrap">
  <!-- LEFT: tool catalog -->
  <aside id="toolCategories" aria-label="Tool Library">
    <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
      <input id="toolSearch" type="search" placeholder="Search tools…" style="flex:1; padding:6px 8px; border:1px solid #ccc; border-radius:6px;">
      <button id="refreshCatalog" type="button">↻</button>
    </div>
    <!-- JS will populate categories & tools here -->
    <div id="toolsList"></div>
  </aside>

  <!-- MIDDLE: canvas + toolbar -->
  <main>
    <div id="toolbar">
      <button id="btnNewPreset" type="button">New</button>
      <select id="presetSelect" title="Presets"></select>
      <button id="savePresetBtn"   type="button">Save</button>
      <button id="clonePresetBtn"  type="button">Clone</button>
      <div class="toolbar-spacer"></div>
      <span id="wfStatus" class="muted">Idle</span>
      <span id="chainBadge" class="badge">Chain OK</span>
      <span id="chainReason" class="muted"></span>
      <span class="muted">Zoom: <strong id="zoomPct">100%</strong></span>
    </div>

    <div id="canvas" aria-label="Workflow Canvas">


<svg id="connectionLayer"></svg>
<div id="canvasContent"
     ondragenter="event.preventDefault()"
     ondragover="event.preventDefault()"
     ondrop="window.Tools.__onCanvasDrop(event)"></div>
<div id="workflowBoxes"
     ondragenter="event.preventDefault()"
     ondragover="event.preventDefault()"
     ondrop="window.Tools.__onCanvasDrop(event)"></div>


    </div>
  </main>

  <!-- RIGHT: run controls, logs, results, config -->
  <section id="rightPanel">
    <div class="panel" style="margin-bottom:8px;">
      <div style="display:flex; gap:6px; flex-wrap:wrap; align-items:center;">
        <button id="runStart"  type="button">Run</button>
        <button id="runPause"  type="button">Pause</button>
        <button id="runResume" type="button">Resume</button>
        <button id="runCancel" type="button">Cancel</button>
        <div class="toolbar-spacer"></div>
        <span id="runProgressLabel" class="muted">0%</span>
      </div>
      <div id="runProgress" style="margin-top:8px;">
        <div id="runProgressBar"></div>
      </div>
    </div>

    <div class="panel" style="margin-bottom:8px;">
      <h3 style="margin:0 0 6px 0;">Logs</h3>
      <pre id="terminalOutput"></pre>
    </div>

    <div class="panel" style="margin-bottom:8px;">
      <h3 style="margin:0 0 6px 0;">Results</h3>
      <div id="results"></div>
    </div>

    <div id="configDrawer" class="panel" style="display:none;">
      <h3 style="margin:0 0 6px 0;">Node Config</h3>
      <textarea id="configJson" spellcheck="false" style="width:100%; height:120px; font:12px/1.4 ui-monospace, SFMono-Regular, Menlo, Consolas, 'Liberation Mono', monospace;"></textarea>
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:8px;">
        <button id="configCancel" type="button">Cancel</button>
        <button id="configSave"   type="button">Apply</button>
      </div>
    </div>
  </section>
</div>
{% endblock %}

{% block scripts %}
  <script defer src="{{ url_for('tools.static', filename='js/ui-bridge.js') }}"></script>
  <script defer src="{{ url_for('tools.static', filename='js/tools.js') }}"></script>
{% endblock %}
























