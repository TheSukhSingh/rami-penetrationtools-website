{% extends "main.html" %}

{% block title %}Blog — Hunter's Terminal{% endblock %}

{% block meta %}
  <link rel="canonical" href="{{ url_for('blog.index', _external=True) }}">
{% endblock %}

{% block head_extra %}
  {# base theme styles (colors, glass, grid, buttons) #}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
{% endblock %}

{% block content %}
<!-- Background Effects (same vibe as landing/tools) -->
<div class="grid-bg"></div>
<div class="scan-lines"></div>
<div class="particles" id="particles"></div>

<main class="main-content">
  <!-- Header -->
  <section class="tools-header">
    <div class="container">
      <div class="header-content">
        <h1 class="header-title">Hunter's <span class="text-cyan">Blog</span></h1>
        <p class="header-subtitle">Updates, research & field notes</p>

        <form method="get" action="{{ url_for('blog.index') }}" class="glass card-hover" style="padding: 16px; margin-top: 16px;">
          <input type="text" name="q" value="{{ q }}" placeholder="Search posts"
                 aria-label="Search posts" class="form-input"
                 style="width:100%; background: transparent; border: none; color: var(--text-main); outline: none;">
          {% if cat %}<input type="hidden" name="cat" value="{{ cat }}">{% endif %}
          {% if tag %}<input type="hidden" name="tag" value="{{ tag }}">{% endif %}
        </form>
      </div>
    </div>
  </section>

  <!-- Posts Grid -->
  <section class="container" style="padding-bottom: 60px;">
    <div class="tools-grid">
      {% for post in items.items %}
      <article class="glass card-hover hover-glow-cyan" style="overflow: hidden;">
        {% if post.cover_path %}
          <a href="{{ url_for('blog.detail', slug=post.slug) }}" class="cover" style="display:block;">
            <img src="{{ post.cover_path }}"
                 alt="{{ post.cover_alt or ('Cover for ' ~ post.title) }}"
                 loading="lazy" style="width:100%; display:block; object-fit:cover;">
          </a>
        {% endif %}

        <div style="padding: 20px;">
          <h2 style="margin-bottom: 8px;">
            <a href="{{ url_for('blog.detail', slug=post.slug) }}" style="text-decoration:none; color: var(--text-main);">
              {{ post.title }}
            </a>
          </h2>

          <p class="text-mute" style="color: var(--text-mute); margin-bottom: 12px;">
            {% if post.published_at %}{{ post.published_at.strftime('%b %d, %Y') }} · {% endif %}
            {{ (post.reading_time or 1) }} min read
            {% if post.category %} · <a href="{{ url_for('blog.by_category', slug=post.category.slug) }}" class="text-cyan">{{ post.category.name }}</a>{% endif %}
          </p>

          {% if post.summary %}
            <p style="margin-bottom: 16px; color: var(--text-main); opacity: .9;">{{ post.summary }}</p>
          {% endif %}

          {% if post.tags %}
            <div style="display:flex; flex-wrap:wrap; gap:8px; margin-bottom: 8px;">
              {% for t in post.tags %}
                <a class="glass-button" href="{{ url_for('blog.by_tag', slug=t.slug) }}">#{{ t.name }}</a>
              {% endfor %}
            </div>
          {% endif %}

          <a class="cyber-button" href="{{ url_for('blog.detail', slug=post.slug) }}">Read Post</a>
        </div>
      </article>
      {% else %}
        <div class="glass" style="padding:20px;">No posts found.</div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    <nav class="container" aria-label="Pagination" style="display:flex; gap:12px; align-items:center; justify-content:center; margin-top:32px;">
      {% if items.has_prev %}
        <a class="glass-button" href="{{ url_for('blog.index', page=items.prev_num, q=q, cat=cat, tag=tag) }}">← Newer</a>
      {% endif %}
      <span class="text-mute">Page {{ items.page }} of {{ items.pages }}</span>
      {% if items.has_next %}
        <a class="glass-button" href="{{ url_for('blog.index', page=items.next_num, q=q, cat=cat, tag=tag) }}">Older →</a>
      {% endif %}
    </nav>
  </section>
</main>
{% endblock %}
